# ğŸ“‹ .npmrc Configuration Guide

> Understanding & troubleshooting BlogSpy's npm configuration

---

## ğŸ¯ What This File Does

The `.npmrc` file controls how npm installs and manages dependencies. It prevents:
- âŒ Version conflicts
- âŒ Peer dependency errors
- âŒ "Works on my machine" issues
- âŒ Production build failures

---

## ğŸ”‘ Key Settings Explained

### 1. **Peer Dependencies** (Most Important!)

```ini
auto-install-peers=true
legacy-peer-deps=false
strict-peer-dependencies=true
```

**Why:**
- Next.js 16 uses React 19
- Radix UI needs specific React versions
- TipTap requires compatible peer deps
- Auto-install prevents manual installation

**Without this:**
```bash
âŒ npm ERR! peer dep missing: react@^19.0.0
âŒ npm ERR! peer dep missing: @radix-ui/react-*
```

---

### 2. **Version Locking**

```ini
save-exact=true
save-prefix=""
```

**Why:**
- `save-exact=true` â†’ Saves `"1.0.0"` not `"^1.0.0"`
- Prevents unexpected updates
- Same versions on all machines

**Example:**
```json
// With save-exact=true
"dependencies": {
  "next": "16.0.7"  // âœ… Exact version
}

// Without (default)
"dependencies": {
  "next": "^16.0.7"  // âŒ Could install 16.1.0
}
```

---

### 3. **Security Audits**

```ini
audit=true
audit-level=moderate
```

**What it does:**
- Checks for vulnerabilities on install
- Warns about moderate+ severity issues
- Keeps dependencies secure

---

### 4. **Network Optimization**

```ini
fetch-retries=3
fetch-retry-mintimeout=10000
prefer-online=false
```

**Why:**
- Retries failed downloads (unstable internet)
- Uses cache when available (faster installs)
- Reduces network traffic

---

## ğŸš¨ Common Issues & Fixes

### Issue 1: Peer Dependency Conflicts

**Error:**
```bash
npm ERR! peer dep missing: react@^19.0.0, required by @radix-ui/react-dialog@1.1.15
```

**Fix:**
```bash
# Delete and reinstall
rm -rf node_modules package-lock.json
npm install

# Or force install peers
npm install --legacy-peer-deps=false
```

**Why it happens:**
- Old `package-lock.json` has wrong versions
- Fresh install resolves correctly

---

### Issue 2: Version Mismatch

**Error:**
```bash
Error: Next.js requires React 19 but found React 18
```

**Fix:**
```bash
# Check current versions
npm list react react-dom

# Update to correct versions
npm install react@19.2.0 react-dom@19.2.0 --save-exact

# Verify
npm list react react-dom
```

---

### Issue 3: Prisma Not Generating

**Error:**
```bash
Error: @prisma/client not found
```

**Fix:**
```bash
# Manual generation
npm run db:generate

# Or reinstall
npm install
# (postinstall script auto-runs prisma generate)
```

---

### Issue 4: Build Fails in Production

**Error:**
```bash
Module not found: Can't resolve 'react'
```

**Fix:**
```bash
# Ensure lock file is committed
git add package-lock.json
git commit -m "fix: update lock file"

# On production server
npm ci  # Uses lock file exactly
```

---

## ğŸ”§ Maintenance Commands

### Clean Install
```bash
# Remove everything and reinstall
rm -rf node_modules package-lock.json
npm install
```

### Update Dependencies (Safely)
```bash
# Check outdated packages
npm outdated

# Update specific package
npm update next --save-exact

# Update all (careful!)
npm update
```

### Verify Installation
```bash
# List all packages
npm list --depth=0

# Check for issues
npm doctor

# Audit security
npm audit
```

### Fix Common Problems
```bash
# Fix peer dependencies
npm install --legacy-peer-deps=false

# Deduplicate
npm dedupe

# Rebuild native modules
npm rebuild
```

---

## ğŸ“Š Version Matrix (BlogSpy)

```
Next.js 16.0.7     â†’ React 19.2.0
React 19.2.0       â†’ React-DOM 19.2.0
Radix UI Latest    â†’ React ^19.0.0
TipTap 3.13.0      â†’ React ^18.0.0 || ^19.0.0
Prisma 6.19.1      â†’ Node >=18.0.0
TypeScript 5.x     â†’ Any Node >=18.0.0
```

---

## ğŸ¯ Best Practices

### DO âœ…
- Commit `.npmrc` to git
- Commit `package-lock.json` to git
- Use `npm ci` in production
- Run `npm audit` regularly
- Keep Node.js updated (18.17.0+)

### DON'T âŒ
- Don't mix npm/yarn/pnpm
- Don't edit `package-lock.json` manually
- Don't use `npm install -g` for project deps
- Don't delete `.npmrc` file
- Don't ignore peer dependency warnings

---

## ğŸ” Debugging Commands

### Check Configuration
```bash
# Show all npm config
npm config list

# Show specific setting
npm config get registry
npm config get auto-install-peers

# Show effective .npmrc
npm config ls -l | grep -v '^;'
```

### Check Versions
```bash
# Node & npm versions
node -v
npm -v

# Package versions
npm list next react typescript

# All dependencies
npm list --all
```

### Check for Conflicts
```bash
# Dry run install
npm install --dry-run

# Show peer dependency tree
npm ls --all
```

---

## ğŸš€ Team Setup (New Developer)

```bash
# 1. Clone repo
git clone <repo-url>
cd blogspy-saas

# 2. Install Node.js 18+ (if needed)
node -v  # Should be 18.17.0+

# 3. Clean install
npm install

# 4. Generate Prisma
npm run db:generate

# 5. Verify
npm run type-check
npm run lint

# 6. Start dev server
npm run dev
```

---

## ğŸ“ Troubleshooting Checklist

When facing npm issues, try in order:

```bash
# 1. Check Node version
node -v  # Must be 18.17.0+

# 2. Clear npm cache
npm cache clean --force

# 3. Delete and reinstall
rm -rf node_modules package-lock.json
npm install

# 4. Verify .npmrc exists
cat .npmrc

# 5. Check for peer dependency issues
npm install --dry-run

# 6. Generate Prisma
npm run db:generate

# 7. Type check
npm run type-check

# 8. Test build
npm run build
```

---

## ğŸ†˜ Still Having Issues?

### Check These:

1. **Node Version**
   ```bash
   node -v
   # Should be 18.17.0 or higher
   ```

2. **NPM Version**
   ```bash
   npm -v
   # Should be 9.0.0 or higher
   ```

3. **Disk Space**
   ```bash
   df -h  # Linux/Mac
   # Ensure 5GB+ free
   ```

4. **Network**
   ```bash
   npm ping
   # Should succeed
   ```

5. **Permissions**
   ```bash
   # Don't use sudo with npm!
   # Fix permissions:
   sudo chown -R $(whoami) ~/.npm
   ```

---

## ğŸ”— Useful Links

- [npm Documentation](https://docs.npmjs.com/)
- [Next.js Requirements](https://nextjs.org/docs/getting-started/installation)
- [React 19 Release](https://react.dev/blog/2024/12/05/react-19)
- [Prisma Setup](https://www.prisma.io/docs/getting-started)

---

## ğŸ“ Contact

If you're still stuck:
1. Check `package.json` scripts
2. Review error messages carefully
3. Search error on GitHub Issues
4. Ask in project Discord/Slack

---

**Last Updated:** December 14, 2025  
**Version:** 1.0  
**Compatible With:** Next.js 16, React 19, Node 18+
